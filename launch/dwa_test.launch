<?xml version="1.0"?>
<launch>
    <arg name="roomba" default="roomba3" />
    <arg name="robot_frame_id" default="$(arg roomba)/base_link" />
    <arg name="map_file" default="$(find roomba_visualizer)/map/map.yaml" />

    <arg name="bagfile" default="/home/amsl/bagfiles/roomba/one_test/scan.bag" />
    <arg name="add_bag_option" default="" />
    <param name="use_sim_time" value="true" />
    <node pkg="rosbag" type="play" name="rosbag_play" args="$(arg bagfile) --clock $(arg add_bag_option)" required="true" />
    <group ns="$(arg roomba)" >
        <node pkg="map_server" type="map_server" name="map_server" args="$(arg map_file)" />
        <node pkg="pole_eliminator" type="pole_eliminator" name="pole_eliminator">
            <remap from="scan" to="scan" />
            <param name="HZ" value="10" />
            <param name="ROBOT_RADIUS" value="0.50" />
            <param name="MARGIN" value="15" />
        </node>
        <node pkg="dwa_planner" type="dwa_planner" name="dwa_planner" output="screen" >
            <rosparam command="load" file="$(find navigator)/config/dwa_param.yaml"/>
            <param name="ROBOT_FRAME" value="$(arg robot_frame_id)" />
            <remap from="/local_map" to="local_map"/>
            <remap from="/scan" to="corrected_scan"/>
            <remap from="/local_goal" to="local_goal"/>
            <remap from="/cmd_vel" to="local_path/cmd_vel"/>
            <remap from="/odom" to="roomba/odometry"/>
        </node>
        <node pkg="navigator" type="navigator_node" name="navigator">
            <rosparam command="load" file="$(find navigator)/config/way_points.yaml" />
        </node>
    </group>

    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find navigator)/rviz/dwa.rviz" />
</launch>
