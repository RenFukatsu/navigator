<?xml version="1.0"?>
<launch>
    <arg name="roomba" default="roomba2" />
    <arg name="hz" default="20"/>
    <arg name="use_scan_as_input" default="true"/>
    <arg name="robot_param" default="$(find dwa_planner)/config/robot_param.yaml"/>
    <arg name="robot_frame_id" default="$(arg roomba)/base_link" />
    <arg name="dwa_param" default="$(find dwa_planner)/config/dwa_param.yaml"/>

    <arg name="bagfile" default="" />
    <arg name="add_bag_option" default="" />
    <group if="$(eval bagfile!='')" >
        <param name="use_sim_time" value="true" />
        <node pkg="rosbag" type="play" name="rosbag_play" args="$(arg bagfile) --clock $(arg add_bag_option)" required="true" output="screen" />
    </group>

    <group ns="$(arg roomba)" >
        <group if="$(eval bagfile=='')" >
            <include file="$(find multi_robots)/launch/launch_devices.launch" >
                <arg name="roomba" default="$(arg roomba)" />
            </include>
        </group>
        <include file="$(find roomba_visualizer)/launch/amcl.launch" >
            <arg name="roomba" default="$(arg roomba)" />
        </include>

        <node pkg="dwa_planner" type="dwa_planner" name="dwa_planner">
            <rosparam command="load" file="$(arg robot_param)"/>
            <rosparam command="load" file="$(arg dwa_param)"/>
            <param name="ROBOT_FRAME" value="$(arg robot_frame_id)" />
            <param name="HZ" value="$(arg hz)"/>
            <param name="USE_SCAN_AS_INPUT" value="$(arg use_scan_as_input)"/>
            <remap from="/local_map" to="local_map"/>
            <remap from="/scan" to="corrected_scan"/>
            <remap from="/local_goal" to="local_goal"/>
            <remap from="/cmd_vel" to="local_path/cmd_vel"/>
            <remap from="/odom" to="roomba/odometry"/>
        </node>

        <node pkg="navigator" type="navigator_node" name="navigator" output="screen">
            <rosparam command="load" file="$(find navigator)/config/way_points.yaml" />
        </node>
    </group>

    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find navigator)/rviz/dwa.rviz" />
</launch>